<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <title>Simple Form</title>
</head>
<body>
    <h1>Simple Form</h1>
    <form>
        Enter your text:<br>
        <input type="text" id="textField" name="textField"><br>
        <input type="button" onclick="submit_data()" value="Send">
    </form>

<script>
    window.Telegram.WebApp.enableClosingConfirmation()

        function decodeJsonFromUrl() {
            // Get the current URL
            const url = window.location.href;

            // Create a URL object
            const urlObj = new URL(url);

            // Get the search parameters
            const params = new URLSearchParams(urlObj.search);

            // Convert search parameters to an object
            const jsonData = {};
            params.forEach((value, key) => {
                const keys = key.split('][');
                let current = jsonData;
                for (let i = 0; i < keys.length; i++) {
                    const k = keys[i].replace(/[\[\]]/g, '');
                    if (i === keys.length - 1) {
                        if (Array.isArray(current[k])) {
                            current[k].push(decodeURIComponent(value));
                        } else if (current[k] !== undefined) {
                            current[k] = [current[k], decodeURIComponent(value)];
                        } else {
                            current[k] = decodeURIComponent(value);
                        }
                    } else {
                        if (!current[k]) {
                            current[k] = isNaN(keys[i + 1]) ? {} : [];
                        }
                        current = current[k];
                    }
                }
            });

            // Log the decoded JSON data
            console.log(jsonData);

            // If you need to convert it to a JSON string
            const jsonString = JSON.stringify(jsonData, null, 2);
            console.log(jsonString);
            return jsonString;
        }




<!--    const queryString = window.location.search;-->
<!--    const urlParams = new URLSearchParams(queryString);-->
<!--    const incom_data = urlParams.get('data');-->
<!--     const tmp = urlParams.get('show_save');-->
<!--    document.getElementById('textField').value = incom_data + '_' + tmp-->
    document.getElementById('textField').value = decodeJsonFromUrl()

    function submit_data() {
        tfv = document.getElementById('textField').value;
        const data = JSON.stringify({data: tfv});
        Telegram.WebApp.sendData(data);
        Telegram.WebApp.close();
    }

</script>
</body>
</html>